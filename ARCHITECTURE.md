# Heart Clinic Management Portal - System Architecture

## High-Level Architecture

```
???????????????????????????????????????????????????????????????????
?                         CLIENT BROWSER                           ?
?  (Patients, Doctors, Admins, Public Visitors)                   ?
???????????????????????????????????????????????????????????????????
                         ?
                         ? HTTPS
                         ?
???????????????????????????????????????????????????????????????????
?                      NEXT.JS APPLICATION                         ?
?                    (Frontend + Backend)                          ?
?                                                                  ?
?  ?????????????????????????????????????????????????????????????? ?
?  ?              PUBLIC PAGES (No Auth)                        ? ?
?  ?  ? Home/Landing                                            ? ?
?  ?  ? About Us                                                ? ?
?  ?  ? Doctors Directory                                       ? ?
?  ?  ? Education Portal                                        ? ?
?  ?????????????????????????????????????????????????????????????? ?
?                                                                  ?
?  ?????????????????????????????????????????????????????????????? ?
?  ?          AUTHENTICATED PORTALS (Auth Required)             ? ?
?  ?  ????????????????  ????????????????  ????????????????    ? ?
?  ?  ?   Patient    ?  ?    Doctor    ?  ?    Admin     ?    ? ?
?  ?  ?   Portal     ?  ?   Dashboard  ?  ?    Panel     ?    ? ?
?  ?  ????????????????  ????????????????  ????????????????    ? ?
?  ?????????????????????????????????????????????????????????????? ?
?                                                                  ?
?  ?????????????????????????????????????????????????????????????? ?
?  ?                     API ROUTES                             ? ?
?  ?  ? /api/appointments                                       ? ?
?  ?  ? /api/medical-records                                    ? ?
?  ?  ? /api/educational-content                                ? ?
?  ?  ? /api/profile/patient                                    ? ?
?  ?  ? /api/profile/doctor                                     ? ?
?  ?  ? /api/doctors                                            ? ?
?  ?????????????????????????????????????????????????????????????? ?
?                                                                  ?
?  ?????????????????????????????????????????????????????????????? ?
?  ?                 MIDDLEWARE LAYER                           ? ?
?  ?  ? NextAuth.js (Session Management)                        ? ?
?  ?  ? RBAC (Role-Based Access Control)                        ? ?
?  ?  ? Input Validation                                        ? ?
?  ?  ? Error Handling                                          ? ?
?  ?????????????????????????????????????????????????????????????? ?
??????????????????????????????????????????????????????????????????
              ?                      ?             ?
              ?                      ?             ?
    ?????????????????????  ??????????????????   ?
    ?   PRISMA ORM      ?  ?  EMAIL SERVICE ?   ?
    ?   (Data Access)   ?  ?   (Resend)     ?   ?
    ?????????????????????  ??????????????????   ?
              ?                                   ?
    ??????????????????????              ??????????????????
    ?   PostgreSQL DB    ?              ?  STRIPE API    ?
    ?  (Medical Data)    ?              ?  (Payments)    ?
    ??????????????????????              ??????????????????
```

## Data Flow

### 1. Patient Booking Appointment

```
Patient Browser
    ?
    ? 1. Navigate to /portal/patient
    ?
    ?
NextAuth Middleware
    ?
    ? 2. Verify session, check userRole=PATIENT
    ?
    ?
Patient Portal Page
    ?
    ? 3. Click "Book Appointment"
    ?
    ?
POST /api/appointments
    ?
    ? 4. Validate: patient can only book for self
    ? 5. Check doctor availability
    ?
    ?
Prisma ORM
    ?
    ? 6. Create appointment record
    ?
    ?
PostgreSQL Database
    ?
    ? 7. Return appointment data
    ?
    ?
Email Service (Resend)
    ?
    ? 8. Send confirmation email
    ?
    ?
Return success to patient
```

### 2. Doctor Viewing Patient Records

```
Doctor Browser
    ?
    ? 1. Navigate to /portal/doctor
    ?
    ?
NextAuth Middleware
    ?
    ? 2. Verify session, check userRole=DOCTOR
    ?
    ?
Doctor Dashboard
    ?
    ? 3. View today's appointments
    ?
    ?
GET /api/appointments?role=DOCTOR
    ?
    ? 4. Filter appointments by doctorId
    ?
    ?
Prisma ORM
    ?
    ? 5. Query appointments with patient details
    ?
    ?
PostgreSQL Database
    ?
    ? 6. Return filtered results
    ?
    ?
Display in doctor dashboard
```

### 3. Admin Managing System

```
Admin Browser
    ?
    ? 1. Navigate to /portal/admin
    ?
    ?
NextAuth Middleware
    ?
    ? 2. Verify session, check userRole=ADMIN
    ?
    ?
Admin Dashboard
    ?
    ? 3. View all system data
    ?
    ?
Multiple API Calls
    ?
    ??? GET /api/appointments (all)
    ??? GET /api/medical-records (all)
    ??? GET /api/doctors (all)
    ?
    ?
Prisma ORM (with proper permissions)
    ?
    ? Admin role = full access
    ?
    ?
PostgreSQL Database
    ?
    ?
Display comprehensive dashboard
```

## Database Schema Relationships

```
User (Core)
 ??? PatientProfile (1:1)
 ?    ??? Medical history, allergies, etc.
 ?
 ??? DoctorProfile (1:1)
 ?    ??? Specialty, qualifications, etc.
 ?
 ??? Appointment (1:Many as Patient)
 ?    ??? Date, time, type (in-person/telehealth)
 ?    ??? Status (booked, confirmed, completed)
 ?
 ??? Appointment (1:Many as Doctor)
 ?
 ??? MedicalRecord (1:Many as Patient)
 ?    ??? Visit notes, diagnoses
 ?    ??? Prescriptions, lab results
 ?    ??? Related to appointment
 ?
 ??? MedicalRecord (1:Many as Doctor)
 ?
 ??? EducationalContent (1:Many as Author)
 ?    ??? Articles, videos
 ?    ??? Categories, tags
 ?
 ??? Payment (1:Many)
      ??? Appointment payments
      ??? Subscription payments
```

## Security Layers

```
???????????????????????????????????????????????????????????????????
? Layer 1: HTTPS/TLS Encryption                                   ?
? ? All traffic encrypted in transit                              ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
? Layer 2: Authentication (NextAuth.js)                           ?
? ? Session-based or JWT authentication                           ?
? ? Password hashing (bcrypt)                                     ?
? ? Email verification                                            ?
? ? Account lockout after failed attempts                         ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
? Layer 3: Authorization (RBAC)                                   ?
? ? Role-based permissions (PATIENT, DOCTOR, ADMIN)               ?
? ? Resource-level access control                                 ?
? ? API route protection                                          ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
? Layer 4: Data Validation                                        ?
? ? Input sanitization                                            ?
? ? Type checking (TypeScript)                                    ?
? ? Schema validation (Prisma)                                    ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
? Layer 5: Database Security                                      ?
? ? Prepared statements (SQL injection prevention)                ?
? ? Row-level security policies                                   ?
? ? Encrypted connections                                         ?
? ? Regular backups                                               ?
???????????????????????????????????????????????????????????????????
```

## Component Architecture

```
???????????????????????????????????????????????????????????????????
?                      PRESENTATION LAYER                          ?
?  ????????????????  ????????????????  ????????????????          ?
?  ?   Pages      ?  ?  Components  ?  ?   Styles     ?          ?
?  ?  (tsx files) ?  ?  (reusable)  ?  ? (Tailwind)   ?          ?
?  ????????????????  ????????????????  ????????????????          ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
?                      BUSINESS LOGIC LAYER                        ?
?  ????????????????  ????????????????  ????????????????          ?
?  ?  API Routes  ?  ?    Hooks     ?  ?  Utilities   ?          ?
?  ?  (backend)   ?  ?  (React)     ?  ?  (helpers)   ?          ?
?  ????????????????  ????????????????  ????????????????          ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
?                      DATA ACCESS LAYER                           ?
?  ????????????????  ????????????????  ????????????????          ?
?  ?   Models     ?  ?  Prisma ORM  ?  ?   Types      ?          ?
?  ? (CRUD ops)   ?  ?  (queries)   ?  ? (TypeScript) ?          ?
?  ????????????????  ????????????????  ????????????????          ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
?                      PERSISTENCE LAYER                           ?
?                    PostgreSQL Database                           ?
???????????????????????????????????????????????????????????????????
```

## Role-Based Access Matrix

| Resource                | Patient | Doctor | Admin |
|------------------------|---------|--------|-------|
| **View own appointments** | ?      | ?     | ?    |
| **View all appointments** | ?      | ?     | ?    |
| **Create appointment**    | ? (self) | ?   | ?    |
| **Cancel appointment**    | ? (own) | ?    | ?    |
| **Update appointment**    | ?      | ?     | ?    |
| **View own medical records** | ?   | ?     | ?    |
| **View patient records**  | ?      | ? (assigned) | ? |
| **Create medical record** | ?      | ?     | ?    |
| **Edit medical record**   | ?      | ? (own) | ?  |
| **View educational content** | ?   | ?     | ?    |
| **Create content**        | ?      | ?     | ?    |
| **Edit content**          | ?      | ? (own) | ?  |
| **Manage users**          | ?      | ?     | ?    |
| **View audit logs**       | ?      | ?     | ?    |

## API Endpoint Summary

### Public Endpoints (No Auth)
- `GET /` - Landing page
- `GET /clinic/about` - About page
- `GET /clinic/doctors` - Doctor directory
- `GET /clinic/education` - Education portal
- `GET /clinic/education/[slug]` - Article detail

### Patient Endpoints (Auth: PATIENT)
- `GET /portal/patient` - Dashboard
- `GET /api/appointments?role=PATIENT` - Own appointments
- `POST /api/appointments` - Book appointment
- `PUT /api/appointments/[id]` - Update own appointment
- `GET /api/medical-records` - Own medical records
- `GET/POST/PUT /api/profile/patient` - Profile management

### Doctor Endpoints (Auth: DOCTOR)
- `GET /portal/doctor` - Dashboard
- `GET /api/appointments?role=DOCTOR` - Own appointments
- `GET /api/medical-records` - Assigned patient records
- `POST /api/medical-records` - Create record
- `PUT /api/medical-records/[id]` - Update own record
- `POST /api/educational-content` - Create content
- `GET/POST/PUT /api/profile/doctor` - Profile management

### Admin Endpoints (Auth: ADMIN)
- `GET /portal/admin` - Dashboard
- `GET /api/appointments` - All appointments
- `GET /api/medical-records` - All medical records
- `DELETE /api/medical-records/[id]` - Delete any record
- `DELETE /api/educational-content/[slug]` - Delete any content
- Full access to all resources

## Deployment Architecture

```
???????????????????????????????????????????????????????????????????
?                         CDN (Optional)                           ?
?                    (Static Assets, Images)                       ?
???????????????????????????????????????????????????????????????????
                         ?
???????????????????????????????????????????????????????????????????
?                    LOAD BALANCER                                 ?
?                  (Distribute Traffic)                            ?
???????????????????????????????????????????????????????????????????
         ?               ?               ?
    ???????????     ???????????     ???????????
    ? Next.js ?     ? Next.js ?     ? Next.js ?
    ? Server 1?     ? Server 2?     ? Server 3?
    ???????????     ???????????     ???????????
         ?               ?               ?
         ?????????????????????????????????
                         ?
         ??????????????????????????????????
         ?   PostgreSQL Primary           ?
         ?   (Read/Write)                 ?
         ??????????????????????????????????
                         ?
         ??????????????????????????????????
         ?   PostgreSQL Replica           ?
         ?   (Read-Only)                  ?
         ??????????????????????????????????
```

## Technology Decisions

### Why Next.js?
- ? Full-stack framework (frontend + backend)
- ? Server-side rendering for SEO
- ? API routes for backend
- ? Built-in optimization
- ? TypeScript support

### Why Prisma?
- ? Type-safe database queries
- ? Auto-generated types
- ? Migration management
- ? Multiple database support
- ? Great developer experience

### Why PostgreSQL?
- ? ACID compliance (critical for medical data)
- ? Strong data integrity
- ? JSON support for flexible fields
- ? Advanced indexing
- ? Proven reliability

### Why NextAuth?
- ? Built for Next.js
- ? Multiple auth providers
- ? Session management
- ? Database or JWT sessions
- ? Easy to extend

## Performance Considerations

### Optimization Strategies
1. **Database Indexes**: All foreign keys and frequently queried fields
2. **Code Splitting**: Automatic with Next.js
3. **Static Generation**: Public pages pre-rendered
4. **API Response Caching**: Where appropriate
5. **Connection Pooling**: Prisma handles automatically
6. **Lazy Loading**: Components loaded on demand
7. **Image Optimization**: Next.js Image component ready

### Scalability
- Horizontal scaling: Add more Next.js servers
- Database read replicas for reporting
- Redis for session storage (optional upgrade)
- CDN for static assets
- Background jobs for heavy operations

---

*This architecture supports HIPAA compliance, scalability, and maintainability.*
